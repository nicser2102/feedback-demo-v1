<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thesis Questionnaire</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }

        /* Hide all screens by default */
        .screen {
            display: none;
        }

        /* Slider styling */
        .slider-container input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
        }
        .slider-container input[type="range"]:hover {
            opacity: 1;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }

        /* Message box styling */
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Loading indicator for saving data */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Message Box -->
    <div id="message-box" class="message-box"></div>

    <div class="max-w-3xl w-full bg-white rounded-xl shadow-2xl p-8 sm:p-12">
        <!-- Timer Display -->
        <div id="timer-display" class="hidden absolute top-4 right-4 bg-blue-500 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>

        <!-- Screen 1: Welcome and Consent -->
        <div id="screen-1" class="screen">
            <h1 class="text-4xl font-bold text-gray-800 mb-6">Welcome and Consent Form</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p>Thank you for participating in this research study.</p>
                <p>This study investigates how individuals approach and perform on a business case task, what they take away from it, and how they feel about the experience, including any feedback they receive.</p>
                <p>Your participation involves completing a short business case exercise, receiving feedback (as part of a simulation), and answering a questionnaire about your perceptions and reactions. The entire process should take approximately 10–15 minutes.</p>
                <h2 class="text-2xl font-semibold mt-6">Data Use and Privacy</h2>
                <p>By participating, you agree that the data you provide—including your responses and performance in the business case—may be analyzed and used for academic research purposes. Your name and surname will not be included in the thesis or any publication. They are only collected to link your business case responses to your questionnaire data in a secure and anonymized manner.</p>
                <p>All data will be treated confidentially and used exclusively for the purposes of this research project.</p>
            </div>

            <div class="mt-8">
                <label for="full-name" class="block text-lg font-medium text-gray-700">Please enter your full name:</label>
                <input type="text" id="full-name" placeholder="Name and Surname" class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="mt-6 flex items-start space-x-3">
                <input type="checkbox" id="consent-checkbox" class="mt-1 h-5 w-5 rounded text-blue-600 border-gray-300 focus:ring-blue-500">
                <label for="consent-checkbox" class="text-gray-700 text-base">By continuing, you confirm that you have read the information above and agree to participate in this study.</label>
            </div>

            <button id="next-1" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 2: Pre-task Perception -->
        <div id="screen-2" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Before we begin the task...</h1>
            <p class="text-gray-700 mb-8">Before we begin the task, we’d like to understand how you perceive yourself in relation to individual business case exercises. Please use the slider to indicate your agreement with each statement. These items refer to your own perceptions of yourself in business case contexts.</p>
            <div class="text-gray-600 mb-6 font-medium">
                <p><strong>Scale:</strong> 0 = Strongly disagree | 10 = Strongly agree</p>
            </div>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q1. I feel like a valuable person when I am working on an individual business case.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q1-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q1-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q2. I feel confident in my ability to solve individual business case problems effectively.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q2-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q2-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q3. I sometimes doubt my worth when I struggle with business case tasks.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q3-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q3-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q4. I have experience working on business cases individually (e.g., for university, assessments, or personal practice).</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q4-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0 = No experience at all</span>
                            <span>10 = Extensive experience</span>
                        </div>
                        <p id="q4-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>
            </div>

            <button id="next-2" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 3: Get Ready for the Business Case -->
        <div id="screen-3" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Get Ready for the Business Case</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p>You're now about to begin the main part of the study: a short individual business case simulation. This is the most important section of the questionnaire, so please take a moment to focus and minimize distractions. Your responses will be evaluated for quality, but there are no right or wrong answers—just do your best.</p>
                <h2 class="text-2xl font-semibold mt-6">Structure of the next two steps:</h2>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li><strong>Step 1:</strong> You will be shown a business case prompt. You’ll have 120 seconds to read and write your response.</li>
                    <li><strong>Step 2:</strong> You’ll be asked a follow-up question, with 90 seconds to respond.</li>
                </ul>
                <p>In both steps, you will write your answer in the text box below, as if you were explaining it to someone else.</p>
                <h2 class="text-2xl font-semibold mt-6">📝 Evaluation Criteria</h2>
                <p>Your response will be assessed based on:</p>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li><strong>Completeness</strong> – Did you consider all key elements of the case?</li>
                    <li><strong>Correctness</strong> – Is your reasoning sound and relevant?</li>
                    <li><strong>Structure</strong> – Did you organize your thoughts clearly, grouping similar variables together into logical clusters to deliver an elegant and easily understandable answer?</li>
                </ul>
            </div>
            <button id="next-3" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 4: Business Case Question 1 -->
        <div id="screen-4" class="screen">
            <div class="absolute top-4 right-4">
                <div id="timer-4" class="bg-blue-500 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Question 1</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed mb-6">
                <p><strong>Prompt</strong></p>
                <p>A diesel truck manufacturer that primarily sells to 3PL (third-party logistics companies), carriers, and private fleet companies (e.g., Amazon) is considering entering the electric vehicle market. The CEO of the company is asking for your advice on whether they should produce and sell electric trucks (e-trucks).</p>
                <p><strong>Question 1</strong></p>
                <p>How would you evaluate whether they should produce and sell electric trucks (e-trucks)? What factors would you consider?</p>
            </div>
            <textarea id="q-case-1" class="w-full h-64 p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Write your response here..."></textarea>
            <button id="next-4" class="mt-6 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 5: Business Case Question 2 -->
        <div id="screen-5" class="screen">
            <div class="absolute top-4 right-4">
                <div id="timer-5" class="bg-blue-500 text-white rounded-full h-12 w-12 flex items-center justify-center font-bold text-lg shadow-lg"></div>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Question 2</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed mb-6">
                <p><strong>Prompt</strong></p>
                <p>Now consider the perspective of potential customers.</p>
                <p><strong>Question 2</strong></p>
                <p>What are the key purchasing decision criteria for customers choosing an electric truck (instead of a diesel one)? What factors do you think influence their decision?</p>
            </div>
            <textarea id="q-case-2" class="w-full h-64 p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Write your response here..."></textarea>
            <button id="next-5" class="mt-6 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 6: Feedback Examples -->
        <div id="screen-6" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Feedback and Score Preview</h1>
            <div class="space-y-4 text-gray-700 leading-relaxed mb-6">
                <p>In the next step, you will receive personalized feedback on your performance in the two business case questions, along with a score from 1 to 10.</p>
                <p>Your responses will be evaluated by an AI model based on clear and objective criteria, including completeness, correctness, and structure. To encourage learning and comparison, your results will be grouped with those of other participants and shared at the end of the study. Below, you can already see feedback and scores from two previous participants:</p>
            </div>
            <div class="space-y-6">
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <div class="flex items-center mb-4">
                        <span class="text-4xl mr-4">🧑‍💼</span>
                        <div class="font-semibold text-lg text-gray-800">Alessio Romano — Score: 8/10</div>
                    </div>
                    <p class="text-gray-700">Both of your responses were well-structured. You correctly identified most of the key drivers related to the market, company strategy, and financial aspects in the first question. In the second question, you identified the drivers related to costs, revenues, investments, and strategic value. However, in both questions, you missed the factors related to potential market entry risks (question 1) and operational and financial risks (question 2).</p>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <div class="flex items-center mb-4">
                        <span class="text-4xl mr-4">👩‍💼</span>
                        <div class="font-semibold text-lg text-gray-800">Giulia Ferri — Score: 6/10</div>
                    </div>
                    <p class="text-gray-700">Both of your responses were poorly structured. In the first question, you correctly identified most of the drivers related to the market and financial aspects. In the second question, you identified drivers related to costs, revenues, and investments. However, in both questions, you missed the factors related to potential market entry risks (question 1), operational and financial risks (question 2), commercial factors (question 1), and potential strategic factors (question 2).</p>
                </div>
            </div>
            <div class="mt-6 text-center text-lg font-semibold text-gray-700">
                📊 Average score so far: 6.57
            </div>
            <div class="mt-8">
                <p class="text-lg font-medium text-gray-800 mb-4">Q5. On a scale from 1 to 10, what score would you like to achieve?</p>
                <div class="slider-container relative">
                    <input type="range" min="1" max="10" value="5" class="w-full" id="q5-slider">
                    <div class="flex justify-between mt-2 text-sm text-gray-600">
                        <span>1</span>
                        <span>10</span>
                    </div>
                    <p id="q5-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                </div>
            </div>
            <div class="mt-6">
                <p class="text-lg font-medium text-gray-800 mb-2">Why do you want to achieve this particular score?</p>
                <textarea id="q5-textbox" class="w-full h-32 p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="(Optional)"></textarea>
            </div>
            <button id="next-6" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 7: Your Score and Feedback -->
        <div id="screen-7" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Your Results</h1>
            <p id="loading-feedback" class="text-center text-lg text-gray-500">Generating your score and feedback... this may take a moment.</p>
            <div id="feedback-content" class="hidden">
                <div class="bg-blue-50 p-8 rounded-xl border border-blue-200 text-center">
                    <p class="text-xl font-semibold text-gray-700">Your Score:</p>
                    <p class="text-6xl font-extrabold text-blue-600 mt-2">
                        <span id="user-score">🎯 7 / 10</span>
                    </p>
                </div>
                <div class="mt-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">AI Feedback on Your Performance</h2>
                    <p id="user-feedback" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div>
            <button id="next-7" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 8: Experience Survey -->
        <div id="screen-8" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Experience with the Business Case</h1>
            <p class="text-gray-700 mb-8">Please answer the following questions about your experience with the business case and feedback process. Use the slider to indicate your level of agreement, where: <strong>0 = Not at all / Absolutely not</strong> | <strong>10 = Completely / Very much so</strong></p>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q6. How would you rate the clarity and presentation of the business case questions?</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q6-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q6-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q7. How accurately do you think the feedback you received reflected your actual abilities?</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q7-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q7-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q8. In your opinion, are business-case-style questions like these a good way to assess a person’s business skills?</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q8-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q8-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>
            </div>
            <button id="next-8" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 9: Emotions Survey -->
        <div id="screen-9" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Emotions and Feedback</h1>
            <p class="text-gray-700 mb-8">Please reflect on how you felt during and after receiving feedback.</p>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q9. To what extent did you feel observed or judged when receiving the feedback?</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="10" value="5" class="w-full" id="q9-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>1 (Not at all)</span>
                            <span>10 (Very strongly)</span>
                        </div>
                        <p id="q9-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q10. To what extent did you think about how others might perceive your feedback or score?</p>
                    <div class="slider-container relative">
                        <input type="range" min="1" max="10" value="5" class="w-full" id="q10-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>1 (Not at all)</span>
                            <span>10 (Very strongly)</span>
                        </div>
                        <p id="q10-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q11. How strongly did you feel each of the following emotions related to the feedback experience?</p>
                    <p class="text-sm text-gray-600">1 = Not at all, 10 = Very strongly</p>
                    <div class="mt-4 space-y-4">
                        <div class="flex items-center space-x-4">
                            <label class="w-1/2 text-gray-700">Anxious or nervous</label>
                            <div class="slider-container relative flex-grow">
                                <input type="range" min="1" max="10" value="5" class="w-full" id="q11a-slider">
                                <div class="flex justify-between mt-2 text-sm text-gray-600">
                                    <span>1</span>
                                    <span>10</span>
                                </div>
                                <p id="q11a-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label class="w-1/2 text-gray-700">Focused on learning and improving for next time</label>
                            <div class="slider-container relative flex-grow">
                                <input type="range" min="1" max="10" value="5" class="w-full" id="q11b-slider">
                                <div class="flex justify-between mt-2 text-sm text-gray-600">
                                    <span>1</span>
                                    <span>10</span>
                                </div>
                                <p id="q11b-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label class="w-1/2 text-gray-700">Discomfort</label>
                            <div class="slider-container relative flex-grow">
                                <input type="range" min="1" max="10" value="5" class="w-full" id="q11c-slider">
                                <div class="flex justify-between mt-2 text-sm text-gray-600">
                                    <span>1</span>
                                    <span>10</span>
                                </div>
                                <p id="q11c-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label class="w-1/2 text-gray-700">Feeling good about myself</label>
                            <div class="slider-container relative flex-grow">
                                <input type="range" min="1" max="10" value="5" class="w-full" id="q11d-slider">
                                <div class="flex justify-between mt-2 text-sm text-gray-600">
                                    <span>1</span>
                                    <span>10</span>
                                </div>
                                <p id="q11d-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button id="next-9" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 10: General Questions -->
        <div id="screen-10" class="screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">General Questions</h1>
            <p class="text-gray-700 mb-8">The following questions are not related to the business case. Please answer them based on your general thoughts and feelings in everyday or professional situations. Use the slider to indicate how much each statement describes you, where: <strong>0 = Not at all</strong> | <strong>10 = Completely</strong></p>

            <div class="space-y-8">
                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q7. I feel nervous when I have to speak or perform in front of other people.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q7-general-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q7-general-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q8. I avoid situations where others might evaluate me.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q8-general-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q8-general-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>

                <div>
                    <p class="text-lg font-medium text-gray-800 mb-4">Q9. I worry about being judged in social or professional situations.</p>
                    <div class="slider-container relative">
                        <input type="range" min="0" max="10" value="5" class="w-full" id="q9-general-slider">
                        <div class="flex justify-between mt-2 text-sm text-gray-600">
                            <span>0</span>
                            <span>10</span>
                        </div>
                        <p id="q9-general-value" class="text-center mt-2 text-lg font-semibold text-blue-600">5</p>
                    </div>
                </div>
            </div>
            <button id="next-10" class="mt-10 w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next</button>
        </div>

        <!-- Screen 11: Final Thank You and Debrief -->
        <div id="screen-11" class="screen">
            <div id="sending-data" class="flex flex-col items-center justify-center p-8">
                <div class="loader"></div>
                <p class="mt-4 text-center text-lg text-gray-600">Invio delle risposte in corso...</p>
            </div>
            <div id="submission-success" class="hidden">
                <h1 class="text-4xl font-bold text-gray-800 mb-6">🎉 Grazie per aver completato il questionario!</h1>
                <div class="space-y-4 text-gray-700 leading-relaxed">
                    <p>Apprezziamo il tuo tempo e il tuo sforzo. Prima di concludere, vorremmo condividere un'ultima precisazione sullo scopo di questo studio.</p>
                    <p>All'inizio del questionario, ti abbiamo chiesto di inserire il tuo nome e cognome. In seguito, ti sono stati mostrati scenari in cui il tuo feedback e il tuo punteggio sembravano essere visibili ad altri partecipanti e confrontati pubblicamente.</p>
                    <p class="text-xl font-bold text-blue-600 mt-6">👉 Questo è stato progettato intenzionalmente come parte dell'esperimento:</p>
                    <p>L'obiettivo di questo studio è capire come le persone reagiscono alla ricezione di feedback quando si sentono osservate rispetto a quando si sentono anonime.</p>
                    <h2 class="text-2xl font-bold text-gray-800 mt-8">🔐 La tua privacy è completamente protetta</h2>
                    <p>Ora puoi tirare un sospiro di sollievo.</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li><span class="font-bold text-green-600">✅</span> Nessuna delle informazioni che hai fornito verrà condivisa con nessuno.</li>
                        <li><span class="font-bold text-green-600">✅</span> Né il tuo nome né le tue prestazioni nel business case possono essere visualizzate dal ricercatore.</li>
                        <li><span class="font-bold text-green-600">✅</span> Tutti i dati vengono automaticamente e irreversibilmente anonimizzati.</li>
                    </ul>
                </div>
            </div>
            <div id="submission-error" class="hidden">
                <h1 class="text-4xl font-bold text-gray-800 mb-6">Ops, qualcosa è andato storto!</h1>
                <p class="text-lg text-gray-700">Non siamo riusciti a inviare le tue risposte. Per favore, prova ad aggiornare la pagina e riprovare, o contatta il ricercatore. Ci scusiamo per l'inconveniente.</p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global State Management ---
            const state = {
                currentScreen: 1,
                name: '',
                consent: false,
                q1: 5, q2: 5, q3: 5, q4: 5,
                q_case_1: '',
                q_case_2: '',
                q5_score: 5, q5_text: '',
                q6: 5, q7: 5, q8: 5,
                q9: 5, q10: 5, q11a: 5, q11b: 5, q11c: 5, q11d: 5,
                q7_general: 5, q8_general: 5, q9_general: 5,
                aiScore: 0,
                aiFeedback: ''
            };

            // Gemini API configuration
            const GEMINI_API_KEY = "AIzaSyBiKlgq8Idj9MorHSH73-QYBeJfe7LQInc"; // INSERISCI QUI LA TUA CHIAVE API DI GEMINI
            const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";

            // Google Apps Script URL (Deploy as Web App, set access to "Anyone")
            // INSERISCI QUI L'URL DEL TUO SCRIPT DI GOOGLE
            const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx9ogPzh5WTL6l-_LjUhJRah28qlpEXy1IXiRt8GNxWGmDWxHHkhYub8i5YduT6SqI4/exec";

            // --- UI Elements ---
            const screens = document.querySelectorAll('.screen');
            const nextButtons = document.querySelectorAll('[id^="next-"]');
            const sliders = document.querySelectorAll('input[type="range"]');
            const messageBox = document.getElementById('message-box');
            const timerDisplay = document.getElementById('timer-display');

            // --- Helper Functions ---
            function showScreen(screenNumber) {
                screens.forEach(screen => screen.style.display = 'none');
                document.getElementById(`screen-${screenNumber}`).style.display = 'block';
                state.currentScreen = screenNumber;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function showMessage(text) {
                messageBox.textContent = text;
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.opacity = '1';
                }, 10);
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    setTimeout(() => messageBox.style.display = 'none', 500);
                }, 3000);
            }

            // Function to update slider value display
            sliders.forEach(slider => {
                const valueDisplay = document.getElementById(slider.id.replace('slider', 'value'));
                slider.addEventListener('input', () => {
                    if (valueDisplay) {
                        valueDisplay.textContent = slider.value;
                    }
                    // Update state for sliders on change
                    const key = slider.id.replace('-slider', '');
                    state[key] = parseInt(slider.value, 10);
                });
            });

            // Timer Function for screens 4 and 5
            function startTimer(duration, onFinish) {
                let timer = duration;
                timerDisplay.style.display = 'flex';
                timerDisplay.textContent = timer;

                const interval = setInterval(() => {
                    timer--;
                    timerDisplay.textContent = timer;
                    if (timer <= 0) {
                        clearInterval(interval);
                        timerDisplay.style.display = 'none';
                        onFinish();
                    }
                }, 1000);

                return interval;
            }

            // --- API Call to Gemini ---
            async function getFeedbackFromAI() {
                document.getElementById('loading-feedback').style.display = 'block';
                document.getElementById('feedback-content').style.display = 'none';

                const prompt = `You are an expert evaluator assessing consulting-style business case responses. You will receive two answers to a business case and must evaluate each individually, assigning a score from 1 to 10 per answer based on clearly defined criteria. Then, provide a structured and standardized feedback paragraph. Finally, calculate the overall score as the average of the two individual scores (rounded to one decimal place).

                📌 Business Case Prompt: A diesel truck manufacturer that primarily sells to 3PL (third-party logistics companies), carriers, and private fleet companies (e.g., Amazon) is considering entering the electric vehicle market. The CEO of the company is asking for your advice on whether they should produce and sell electric trucks (e-trucks).

                🔹 Question 1: How would you evaluate whether they should produce and sell electric trucks (e-trucks)? What factors would you consider?

                Reference solution for Question 1:
                1. E-truct market
                -Size and growth rate
                -Largest e-truck producers (incl. market shares and key differentiating points)
                -Average margin in the space
                2. Diesel truck manufacturer
                -Target customer segments for e-trucks (same B2B or B2C too?)
                -Expected e-truck model (e.g., type, key selling points)
                -Distribution (own/partner dealerships; online; etc.)
                3. Valuation
                -Expected capex
                -Investment criteria (e.g., ROI, NPV, payback period)
                -Expected profitability (incl. synergy analysis):
                --Revenue
                --Costs
                4. Market entry risks
                -Market-specific risks
                -Financial risks
                -Operational risks

                🟠 Scoring criteria for Question 1 (1-10 total):
                Structure (0 to 2 points):
                2 points: Well-structured around 4 key areas (e.g., market, internal fit, financials, risks).
                1.75–1 points: Slightly different structure but logically consistent and complete.
                1–0.25 points: Weak structure or missing areas, but follows a rational sequence.
                0 points: No structure or disorganized response.
                Variables and Factors Considered (1 to 8.5 points):
                Award points based on the number of relevant variables mentioned (using synonyms and interpretation allowed):
                9+ variables = 8.5 points
                8 variables = 7
                7 variables = 6
                5 variables = 4
                4 variables = 3
                3 variables = 2
                2 variables = 1
                Fewer than 2 = 0

                🔹 Question 2: What are the key purchasing decision criteria for customers choosing an electric truck (instead of a diesel one)? What factors do you think influence their decision?
                
                Reference solution for Question 2:
                1. Financial analysis
                -Cost factors:
                --Truck price
                --Maintenance (spare parts, services)
                --Fuel/electricity consumption
                --Insurance
                -Revenue factors:
                --Truck's useful life
                --Capacity (power, payload, mileage)
                --Utilization rate (due to fewer repairs)
                --Salvage value
                -Investment:
                --ROI/payback
                --Capex for charging stations
                2. Strategic value
                -Customer experience improvements
                --Brand image (eco-friendly)
                -Risk diversification
                --Less dependency on oil/gas
                --Lower legal/pollution compliance risks
                3. Risks
                -Operational risks:
                --Lack of support infrastructure (mechanics, service stations)
                --Dual-fleet complexity
                --Immature tech (design flaws)
                --Charging time
                --Lack of charging stations
                -Financial risks:
                --Loss of scale economies
                --Underestimated costs or optimistic revenues
                
                🟠 Scoring criteria for Question 2 (1-10 total):
                Structure (0 to 1 point):
                1 point: Clear structure following the 3 key areas
                0.5 points: Some logical grouping of factors
                0 points: No structure
                Variables and Factors Considered (1 to 7.5 points):
                9+ variables = 7.5
                8 variables = 7
                7 variables = 6.5
                6 variables = 5.5
                5 variables = 4.5
                4 variables = 4
                3 variables = 3
                2 variables = 2
                1 variable = 1
                Diversity of Areas Covered (0 to 1.5 points):
                Based on how many of the following categories are covered:
                Costs Factors, Revenue Factors, Investment, Improvement in Customer Experience, Risk Diversification, Operational Risks, Financial Risks
                Scoring:
                5+ areas = 1.5
                4 areas = 1.25
                3 areas = 1
                2 areas = 0.5
                1 area = 0

                ✅ Final Output Format:
                Score: [Average of the two individual question scores, 1 decimal place]
                Feedback:
                Your feedback must follow this exact structure and adapt only to the candidate’s performance. Fill in the brackets appropriately:
                The answer to Question 1 was [well structured and included all key areas / well structured but missed some key areas such as... / poorly structured but followed a logical flow; it could have been structured into the following 4 areas... / poorly structured and lacked logical order; it could have been organized into the following areas...].
                You included [most of the key factors needed to assess this type of problem / a good number of relevant factors / some relevant factors, but could have also included... / very few relevant factors; you should have considered at least the following variables...].
                In Question 2, you [structured your answer well / attempted to follow a logical structure but could have organized it as follows... / listed the factors in a disorganized way and could have structured it as follows...].
                You mentioned [a large number of variables across multiple areas / a large number of variables but focused on a narrow set of areas / a good amount of variables across a few areas / only a few variables].
                Other relevant variables you could have included are: [list here].

                Only return the score and the feedback paragraph. Do not include any explanation of how you arrived at your score.

                Here are the user's answers:
                ---
                Question 1 Answer:
                ${state.q_case_1}

                Question 2 Answer:
                ${state.q_case_2}
                ---
                `;

                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

                let retries = 0;
                const maxRetries = 5;
                const baseDelay = 1000; // 1 second

                async function fetchWithExponentialBackoff() {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429 && retries < maxRetries) {
                            const delay = baseDelay * Math.pow(2, retries);
                            retries++;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return await fetchWithExponentialBackoff();
                        } else if (!response.ok) {
                             throw new Error(`API error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            // Parse the AI's response
                            const scoreMatch = text.match(/Score:\s*([\d.]+)/);
                            const feedbackMatch = text.match(/Feedback:\s*([\s\S]*)/);
                            if (scoreMatch && feedbackMatch) {
                                state.aiScore = parseFloat(scoreMatch[1]);
                                state.aiFeedback = feedbackMatch[1].trim();

                                document.getElementById('user-score').textContent = `🎯 ${state.aiScore.toFixed(1)} / 10`;
                                document.getElementById('user-feedback').textContent = state.aiFeedback;

                                document.getElementById('loading-feedback').style.display = 'none';
                                document.getElementById('feedback-content').style.display = 'block';
                            } else {
                                throw new Error("AI response format is unexpected.");
                            }
                        } else {
                            throw new Error("AI response content is missing or malformed.");
                        }
                    } catch (error) {
                        console.error('Error fetching AI feedback:', error);
                        showMessage("An error occurred while generating feedback. Please try again.");
                        document.getElementById('loading-feedback').textContent = "Failed to load feedback.";
                    }
                }
                
                fetchWithExponentialBackoff();
            }

            // Function to send data to Google Sheet
            async function sendDataToSheet() {
                document.getElementById('sending-data').style.display = 'flex';
                document.getElementById('submission-success').style.display = 'none';
                document.getElementById('submission-error').style.display = 'none';

                const data = {
                    name: state.name,
                    q1: state.q1, q2: state.q2, q3: state.q3, q4: state.q4,
                    q_case_1: state.q_case_1,
                    q_case_2: state.q_case_2,
                    q5_score: state.q5_score,
                    q5_text: state.q5_text,
                    q6: state.q6, q7: state.q7, q8: state.q8,
                    q9: state.q9, q10: state.q10, q11a: state.q11a, q11b: state.q11b, q11c: state.q11c, q11d: state.q11d,
                    q7_general: state.q7_general, q8_general: state.q8_general, q9_general: state.q9_general,
                    aiScore: state.aiScore,
                    aiFeedback: state.aiFeedback
                };
                
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify(data),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    // Check if the response is ok before trying to parse JSON
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.result === 'success') {
                        document.getElementById('sending-data').style.display = 'none';
                        document.getElementById('submission-success').style.display = 'block';
                    } else {
                        // Log the error from the server, if available
                        console.error('Error from Google Apps Script:', result.error);
                        document.getElementById('sending-data').style.display = 'none';
                        document.getElementById('submission-error').style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error sending data to Google Sheet:', error);
                    document.getElementById('sending-data').style.display = 'none';
                    document.getElementById('submission-error').style.display = 'block';
                }
            }


            // --- Event Handlers ---
            nextButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const buttonId = button.id;
                    switch (buttonId) {
                        case 'next-1':
                            const fullName = document.getElementById('full-name').value.trim();
                            const consent = document.getElementById('consent-checkbox').checked;
                            if (fullName && consent) {
                                state.name = fullName;
                                showScreen(2);
                            } else {
                                showMessage("Please enter your full name and agree to participate.");
                            }
                            break;
                        case 'next-2':
                            showScreen(3);
                            break;
                        case 'next-3':
                            showScreen(4);
                            window.timerInterval = startTimer(120, () => {
                                // Auto-advance on timeout
                                state.q_case_1 = document.getElementById('q-case-1').value.trim();
                                showScreen(5);
                                window.timerInterval = startTimer(90, () => {
                                    state.q_case_2 = document.getElementById('q-case-2').value.trim();
                                    showScreen(6);
                                });
                            });
                            break;
                        case 'next-4':
                            clearInterval(window.timerInterval);
                            timerDisplay.style.display = 'none';
                            state.q_case_1 = document.getElementById('q-case-1').value.trim();
                            if (state.q_case_1) {
                                showScreen(5);
                                window.timerInterval = startTimer(90, () => showScreen(6));
                            } else {
                                showMessage("Please provide your answer before proceeding.");
                            }
                            break;
                        case 'next-5':
                            clearInterval(window.timerInterval);
                            timerDisplay.style.display = 'none';
                            state.q_case_2 = document.getElementById('q-case-2').value.trim();
                            if (state.q_case_2) {
                                showScreen(6);
                            } else {
                                showMessage("Please provide your answer before proceeding.");
                            }
                            break;
                        case 'next-6':
                            state.q5_score = parseInt(document.getElementById('q5-slider').value, 10);
                            state.q5_text = document.getElementById('q5-textbox').value.trim();
                            showScreen(7);
                            getFeedbackFromAI();
                            break;
                        case 'next-7':
                            showScreen(8);
                            break;
                        case 'next-8':
                            showScreen(9);
                            break;
                        case 'next-9':
                            showScreen(10);
                            break;
                        case 'next-10':
                            showScreen(11);
                            sendDataToSheet();
                            break;
                    }
                });
            });

            // Initial screen display
            showScreen(1);
        });
    </script>
</body>
</html>
